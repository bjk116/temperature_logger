"""
For analyzing the data from temp.log
and then logging that.

Using python 2.7
"""
import os
import datetime
import pytz
from dateutil.parser import parse as date_parse
import mysql.connector

def convert_timezone(dt, tz):
    """
    Found this on stack overflow.  Necessary currently because our pi thinks
    its in UTC.  I'm leaving it in as it's decent real world practice for manipulating
    datat that isn't tidy or neat or the format you want.
    Args:
        dt: datetime string
        tz: desired timezone
    Returns:
        dt: datetime object
    """
    dt = date_parse(dt)
    tz = pytz.timezone(tz)
    dt = dt.astimezone(tz)
    return dt

def get_db_connection():
    """
    Included in this script for learnings sake
    Args:
        None, stuff is hard coded for ease of use
    Returns:
        cnx, connection object to local mysql db.
    """
    cnx = mysql.connector.connect(user="root", password="Normie419",
                                  host="127.0.0.1",
                                  database="production")
    return cnx

def analyze_full_file(file_path='//home//projects//temperature_logger'):
    """
    Scans in the entirety of the temp.log file, figures out the
    unique dates, gets the max, min, and average temperature, and
    then writes that to a file.
    Args:
        file_path: string, path to temp file.
    """
    with open(os.path.join(file_path, 'temp.log'), "r") as temperature_log_file:
        
for line in temperature_log_file:
            stripped_line = line.strip()
            temperature, t_stamp = tuple(stripped_line.split(','))
            temperature = temperature.split('C')[0]
            print("temp is %s"%(str(temperature)))
            t_stamp = convert_timezone(t_stamp, 'EST')
            print("t_stamp %s"%(str(t_stamp)))
            print("t_stamp type is %s"%(str(type(t_stamp))))

if __name__ == '__main__':
    analyze_full_file()
    print("success")
